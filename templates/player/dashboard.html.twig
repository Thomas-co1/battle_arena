{% extends 'base.html.twig' %}

{% block title %}Mon Compte - Battle Arena{% endblock %}
{% block content %}
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="text-white">üë§ Mon Compte</h1>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body text-center">
                    <h2>{{ player.gamertag }}</h2>
                    <p class="text-muted">{{ app.user.email }}</p>
                    <hr>
                    <p><strong>Perso:</strong> {{ player.mainCharacter }}</p>
                    <p><strong>Niveau:</strong> {{ player.skillLevel }}/15</p>
                    <p><strong>Inscrit:</strong> {{ player.createdAt|date('d/m/Y') }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Statistiques</h5>
                    <div class="d-flex justify-content-around">
                        <div class="text-center">
                            <h3 class="text-success">{{ player.wins }}</h3>
                            <small class="text-muted">Victoires</small>
                        </div>
                        <div class="text-center">
                            <h3 class="text-danger">{{ player.losses }}</h3>
                            <small class="text-muted">D√©faites</small>
                        </div>
                        <div class="text-center">
                            <h3 class="text-primary">{{ player.getWinRate() }}%</h3>
                            <small class="text-muted">Taux Victoire</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Actions</h5>
                    <a href="{{ path('app_player_dashboard') }}" class="btn btn-primary btn-sm btn-block w-100 mb-2">Actualiser</a>
                    <a href="#" class="btn btn-secondary btn-sm btn-block w-100">√âditer profil</a>
                </div>
            </div>
        </div>
    </div>

    {% if pendingMatches %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">Matchs √† Jouer üî¥</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Adversaire</th>
                                    <th>Perso</th>
                                    <th>Tournoi</th>
                                    <th>Date Pr√©vue</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in pendingMatches %}
                                    {% set opponent = match.player1 == player ? match.player2 : match.player1 %}
                                    <tr>
                                        <td><strong>{{ opponent.gamertag }}</strong></td>
                                        <td>{{ opponent.mainCharacter }}</td>
                                        <td>{{ match.tournament.name }}</td>
                                        <td>
                                            {% if match.scheduledDate %}
                                                {{ match.scheduledDate|date('d/m/Y H:i') }}
                                            {% else %}
                                                Non d√©finie
                                            {% endif %}
                                        </td>
                                        <td>
                                            <a href="{{ path('app_player_submit_result', {id: match.id}) }}" class="btn btn-success btn-sm">
                                                Saisir r√©sultat
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Historique des Matchs</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Adversaire</th>
                                <th>Tournoi</th>
                                <th>Date</th>
                                <th>R√©sultat</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in allMatches|reverse %}
                                {% if match.finished %}
                                    {% set opponent = match.player1 == player ? match.player2 : match.player1 %}
                                    <tr>
                                        <td><strong>{{ opponent.gamertag }}</strong></td>
                                        <td>{{ match.tournament.name }}</td>
                                        <td>{{ match.playedDate|date('d/m/Y H:i') }}</td>
                                        <td>
                                            {% if (match.player1 == player and match.player1Result.value == 'win') or (match.player2 == player and match.player2Result.value == 'win') %}
                                                <span class="badge bg-success">Victoire</span>
                                            {% elseif (match.player1 == player and match.player1Result.value == 'loss') or (match.player2 == player and match.player2Result.value == 'loss') %}
                                                <span class="badge bg-danger">D√©faite</span>
                                            {% else %}
                                                <span class="badge bg-secondary">√âgalit√©</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if match.player1 == player %}
                                                {{ match.player1Score }} - {{ match.player2Score }}
                                            {% else %}
                                                {{ match.player2Score }} - {{ match.player1Score }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% if not allMatches %}
                        <div class="alert alert-info m-3 mb-0">
                            Aucun match jou√©e pour le moment
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
